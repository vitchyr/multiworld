import roboverse.bullet as bullet
import numpy as np
import pybullet as p
from gym.spaces import Box, Dict
from collections import OrderedDict
from roboverse.envs.sawyer_base import SawyerBaseEnv
from multiworld.envs.env_util import create_stats_ordered_dict
from roboverse.bullet.misc import load_obj, deg_to_quat, draw_bbox
import os.path as osp
import importlib.util
import random
import pickle
import gym

obj_path_map = {
    "long_sofa": "04256520/68fce005fd18b5af598a453fd9fbd988",
    "l_sofa": "04256520/575876c91251e1923d6e282938a47f9e",
    "conic_bin": "02747177/cf158e768a6c9c8a17cab8b41d766398",
    "square_prism_bin": "02747177/9fe4d78e7d4085c2f1b010366bb60ce8",
    #"faucet": "03325088/1f223cac61e3679ef235ab3c41aeb5b6",
    "bunsen_burner": "03325088/7ade4c8d7724e56b76d20e73c57c9a03",
    "wide_circular_vase": "02880940/53f5240e1e82c96e2d20e9f11baa5f8f",
    "flat_circular_basket": "02880940/6a772d12b98ab61dc26651d9d35b77ca",
    "pitcher": "02876657/3ba7dd61736e7a96270c0e719fe4ed97",
    "gatorade": "02876657/d9aee510fd5e8afb93fb5c975e8de2b7",
    "narrow_tray": "02801938/d224635923b9ec4637dc91749a7c4915",
    "jar": "03593526/6e44adec0854dfaa93fb5c975e8de2b7",
    "horn_vase": "03593526/dd37047caaffb379f9215f842248bc25",
    "fountain_vase": "03593526/4cd2f74d052b561952e2d18963a75b4d",
    "narrow_top_vase": "03593526/c5beb87c12986f859f3323e6dbd51308",
    "long_vase": "03593526/1a9dade4e4a4c47589035c25f0dfeb63",
    "conic_cup": "03593526/7c1303d3a19a1cef51f77a6d7299806",
    "camera": "02942699/235a6dd25c0a6f7b66f19f26ac490096",
    "mug": "03797390/1d18255a04d22794e521eeb8bb14c5b3",
    "conic_bowl": "03991062/3152bd6fb7bf09d625ebd1cd0b422e32",
    "ball": "03991062/8d87b950d8e192f5f51f77a6d7299806",
    "hex_deep_bowl": "03991062/1c4257c50d27388525ebd1cd0b422e32",
    "square_deep_bowl": "03991062/eb8d2e7e18906c7f25ebd1cd0b422e32",
    "bird": "02691156/886942791e830bf1d32b1717fde97410",
    "pillow": "03938244/3b5e274f653258a737f437b479038901",
    "shed": "02843684/7dd57384aa290a835821cea205f2a4bb",
    "oblong_scooper": "04530566/9472a24df8372cd42e436d38f27146ec",
    "beer_bottle": "02876657/5ad47181a9026fc728cc22dce7529b69",
    "sack_vase": "03593526/a258544f4f27cb7fbbdc99ec57ef9c40",
    "smushed_dumbbell": "03593526/c8d8974642d4e88e906c240b881af04f",
    "grill_bench": "04379243/17624075a52c9b15cab01e89f60c9290",
    "circular_picnic_table": "04379243/24d1d32aa33c38716a97150bb2a72733",
    "circular_table": "04379243/d6b61af7935d36a6f0aeabfdcb4e1dd9",
    # Below: mostly colorless objects. Added June 19 2020.
    "short_handle_cup": "03797390/3143a4accdc23349cac584186c95ce9b",
    "curved_handle_cup": "03797390/c39fb75015184c2a0c7f097b1a1f7a5",
    "flowery_half_donut": "02880940/e4c871d1d5e3c49844b2fa2cac0778f5",
    "semi_golf_ball_bowl": "02880940/45603bffc6a2866b5d1ac0d5489f7d84",
    "passenger_airplane": "02691156/d605a53c0917acada80799ffaf21ea7d",
    "open_top_rect_box": "03991062/9da456e7bae24501ffc6e457221b9271",
    "cookie_circular_lidless_tin": "03991062/5563324c9902f243a2c59a4d90e63212",
    "chipotle_bowl": "02808440/302618414a9991de3321831d2245cf06",
    "toilet_bowl": "02808440/fd34f47eb1b816139a625c8b524db46e",
    "buffet_food_tray": "02808440/1dc36bb29702c28b3321831d2245cf06",
    "keyhole": "02808440/ea7913efbe22abed412deb0d2b0f3dcd",
    "bathtub": "02808440/cca20dbad3faf4343321831d2245cf06",
    "crooked_rim_capsule_container": "02818832/4954953090ca7442527e7f2c027f7469",
    "colunnade_top": "03593526/de673ddf9df03b8278cf1a714198918",
    "pacifier_vase": "03593526/1ca73dffe31553efcb349a60fd15aa15",
    "square_rod_embellishment": "03593526/bcf5a4b764ddeac759f9892433e1b1f4",
    "bongo_drum_bowl": "03593526/a791d4fa1d840408c5beea20858a99d5",
    "flat_bottom_sack_vase": "03593526/9097ce398b9700a27e561f865dc44fc5",
    "stalagcite_chunk": "03593526/6a13375f8fce3142e6597d391ab6fcc1",
    "pear_ringed_vase": "03593526/c1be3d580b4088bf4cc80585c0d3d970",
    "two_handled_vase": "03593526/2ff5347d6ee079855337cdc4b758988c",
    "goblet": "03593526/cf65c7fb56850194490ad276cd2af3a4",
    "ringed_cup_oversized_base": "03593526/aa638e39c28f3a184800dfbcda5cce3",
    "t_cup": "03593526/ffc7e98720e71017b3878cedd8c8fe6c",
    "teepee": "03593526/af61c129521b9a36ad56360b1d2e97b8",
    "bullet_vase": "03593526/ce2508ec4476b2cbf51f77a6d7299806",
    "haystack_sofa": "04256520/e74d866f44f857e77b5d58e18a4bdcae",
    "box_wood_frame": "04256520/5171a910435f4c949a502993c14408e4",
    "rect_spotted_hollow_bottom_sofa": "04256520/c8108de19d8a3005c5beea20858a99d5",
    "box_sofa": "04256520/ae4f28a7c4e22d9535dda488a4bbb1e1",
    "earmuff": "03261776/51245ad5a0571188992fd3dac901d508",
    "l_automatic_faucet": "03325088/13cdb5df9a944fcbb7a867e9b35a1295",
    "double_l_faucet": "03325088/af708fe6eac1bc9450da8b99982a3057",
    "box_crank": "03325088/4477714b35747609f34d244dc02df229",
    "glass_half_gallon": "02876657/8ea8ced5529a3ffa7ae0a62f7ca532f1",
    "pepsi_bottle": "02876657/cdeccf2f410846d0e0155f56493d36bc",
    "two_layered_lampshade": "03636649/23eaba9bdd51a5b0dfe9cab879fd37e8",
    "beehive_funnel": "03636649/ed323758d0f61cfe6085a0a38e2f255",
    "rabbit_lamp": "03636649/a82af4e7e81334f8876b399a99a15c0f",
    "elliptical_capsule": "03636649/11913615a1b732d435836c728d324152",
    "trapezoidal_bin": "02801938/98c3ddee85264efd7cd51b1084c649a6",
    "staple_table": "04379243/ec316148b4cdd446b6068c62e84866a1",
    "grill_park_bench": "02828884/3e0694b77418eb25d2b12aa6a0f050b3",
    "thick_wood_chair": "02828884/6f0723826537010c870f22c94729669b",
    "park_grill_chair": "02828884/5b50871735c5cce2d2b12aa6a0f050b3",
    "long_half_pipe_smooth_park_chair": "02828884/8d074f177479ac42628516f95b4691f",
    "flat_boat_dish": "04530566/80c6a14accb189a9c2c2c81e2232aa95",
    "modern_canoe": "04530566/31a41e6a73c5d019efffdb45d12d0585",
    "vintage_canoe": "04530566/de010f7468ceefc6fcfb3ae2df2f7efd",
    "oil_tanker": "04530566/6c1cfb2fe245b969c2e818a707fdb3e0",
    "x_curved_modern_bookshelf": "02871439/43731a6a4bd64ae5492d9da2668ec34c",
    "pitchfork_shelf": "02871439/cc38bc7db90f43d214b86d5282eb8301",
    "baseball_cap": "02954340/e823673c1edd73fb97c426435543a860",
    "tongue_chair": "03001627/ddfe96c6ec86b8752cbb5ed9636a4451",
    "grill_trash_can": "02747177/8fff3a4ba8db098bd2b12aa6a0f050b3",
    "crooked_lid_trash_can": "02747177/e7682974949a6aadea9a778eef212687",
    "aero_cylinder": "02747177/4dbbece412ef64b6d2b12aa6a0f050b3",
}

path_scaling_map = {
    '02880940/36ca3b684dbb9c159599371049c32d38': 0.45965730943522365,
    '02880940/a95e0d8b37f8ca436a3309b77df3f951': 0.36703896426587984,
    '02880940/4eefe941048189bdb8046e84ebdc62d2': 0.45971293864088836,
    '02880940/be3c2533130dd3da55f46d55537192b6': 0.338349532841341,
    '02880940/13e879cb517784a63a4b07a265cff347': 0.3405685000353549,
    '02880940/a0ac0c76dbb4b7685430c0f7a585e679': 0.4220359444118124,
    '02880940/c1bad5cc2d9050e48aee29ee398d36ed': 0.43360284129832355,
    '02880940/468b9b34d07eb9211c75d484f9069623': 0.4207776647482278,
    '02880940/4845731dbf7522b07492cbf7d8bec255': 0.5089325517195429,
    '02880940/3f6a6718d729b77bed2eab6efdeec5f8': 0.4056270812581569,
    '02880940/429a622eac559887bbe43d356df0e955': 0.43217701074761466,
    '02880940/53f5240e1e82c96e2d20e9f11baa5f8f': 0.3890823579750363,
    '02880940/cfac22c8ca3339b83ce5cb00b21d9584': 0.3777578051365221,
    '02880940/4fdb0bd89c490108b8c8761d8f1966ba': 0.408533026934377,
    '02880940/6a772d12b98ab61dc26651d9d35b77ca': 0.3844594937560873,
    '02880940/e816066ac8281e2ecf70f9641eb97702': 0.39804690559902695,
    '02880940/ce48ffb418b99996912a38ce5826ebb8': 0.45889903239684793,
    '03593526/5c2079f8089b0419ca2de9a00262030f': 0.27694626342895723,
    '03593526/763474ce228585bf687ad2cd85bde80a': 0.3445859686627363,
    '03593526/dd37047caaffb379f9215f842248bc25': 0.2990776122148093,
    '03593526/c444d4f782c68dc9140cbb818dee6c': 0.16974940177530076,
    '03593526/9bbc7da5313433c4af93a86670701266': 0.3330951252015812,
    '03593526/c673160553979cebd37947b3ce04a083': 0.23171297743164307,
    '03593526/6e44adec0854dfaa93fb5c975e8de2b7': 0.19166065022588555,
    '03593526/8c1d8325da907adf51f77a6d7299806': 0.2382718975304827,
    '03593526/21efadc7372648164b3c42e318f3affc': 0.21373601333644607,
    '03593526/7d71fc51ce793a44befd8bfd61b07f5': 0.33623146350607347,
    '03593526/7c1303d3a19a1cef51f77a6d7299806': 0.2520942787595406,
    '03593526/1d4a469bdb53d3f77a3f900e0a6f2d83': 0.4047709455873128,
    '03593526/6f2c815565cfdb97a1c637e821f12a67': 0.2362220644831522,
    '03593526/ac95989d0e196b4a98d5fc0473d00a1c': 0.2757251510707145,
    '03593526/9998f783571e10a7d680196133d8b70f': 0.3599957530831075,
    '03593526/2fc5fff977ac930050b92125e5fcb8ac': 0.1777251222989879,
    '03593526/a258544f4f27cb7fbbdc99ec57ef9c40': 0.23117363410603475,
    '03593526/275cc21fad6aa1b6bfa78a7d067c469c': 0.24055120706716254,
    '03593526/ee425a7b654bcac8bbdc99ec57ef9c40': 0.24435537419787864,
    '03593526/4cd2f74d052b561952e2d18963a75b4d': 0.3118095112250866,
    '03593526/c5beb87c12986f859f3323e6dbd51308': 0.2644849674672597,
    '03593526/4b574003434d2ba041034a9ebee74b0c': 0.2871417452802942,
    '03593526/930e0e91518dedaf8b5a342cfa6159b4': 0.2689400951946232,
    '03593526/9e03b1cd20644a638c37cfe791015e2f': 0.40401051854908365,
    '03593526/9fe7e6a7bf8ca964efad53eb3f0b36fa': 0.3181704164311424,
    '03593526/d67ac9e710ba445089035c25f0dfeb63': 0.3255950049034956,
    '03593526/99f6281962f4b4e598910e50f05b8001': 0.2006863623667775,
    '03593526/81a4a5f10f2f759fcee8a4975a4efb00': 0.2518933552228041,
    '03593526/c5fda0e7168d23ed89035c25f0dfeb63': 0.253426781500805,
    '03593526/1a9dade4e4a4c47589035c25f0dfeb63': 0.35625682654873153,
    '03593526/a2da98dc3d78788435836c728d324152': 0.23115324449174063,
    '03593526/5b13716dfa70014c726dbbf7bc5e4df3': 0.2675489566377274,
    '03593526/c8d8974642d4e88e906c240b881af04f': 0.19730288914781574,
    '03593526/d6b6a7a860cfeeda2f2318fdd66be40a': 0.3408394459498629,
    '03001627/fa7347547e290732bf65e1af50b5b7d4': 0.44174088068908574,
    '03001627/bea846f692c8bdc8ce6fb1d4c6089968': 0.37984540054562693,
    '03001627/9d7d7607e1ba099bd98e59dfd5823115': 0.36890936771015886,
    '03001627/1d99f74a7903b34bd56bda2fb2008f9d': 0.32225328850799767,
    '03001627/8cedc8e684d60ff42a06d8c81262ef96': 0.3345418252491842,
    '03001627/f19e8da9d8f369c531e63f1270e2b445': 0.3423358235487716,
    '03001627/87afe5137d675efb73418f9a8c25ad1a': 0.2924477558270245,
    '03001627/ca84b42ab1cfc37be25dfc1bbeae5325': 0.28999262928033687,
    '03001627/d9156f5552178de2713decb1a0563b12': 0.29057178751468143,
    '03001627/73b7d6df845221fa9a2041f674671d05': 0.25093906579617997,
    '03001627/26aa22bd1da8b8c5b1a5c6ecbc81953c': 0.3532808881414112,
    '03001627/61f71cc002f6da561c81652b127a0ec9': 0.26922978140659054,
    '03001627/5822ae77b06bea3091da37ff8bdd2524': 0.29812108391771996,
    '03001627/8b5f8b83715a378e473f10e6caaeca56': 0.2178062649967445,
    '03001627/3e2375ff9e7af8002861ed753d5b88a1': 0.30838812435176965,
    '03001627/4a12589099b05c51e13b3410f3683610': 0.19656299929858378,
    '03001627/98d1fb12c3354d341e67ee2399c63faa': 0.23064667769159686,
    '03001627/c236deaff8c6fb0d29c9a7a92b0a566d': 0.25955749038420006,
    '03001627/56e51afd9d5c5fa38b7a92edf72424a7': 0.2653214767854839,
    '03001627/23c4d774910c9ce03c832f0140db42bc': 0.2848197975362282,
    '03001627/c4a73db5b3503ffa86abe5555a3b447d': 0.31817389272680696,
    '03001627/b24ed89d85b74771216fff6094e6695c': 0.3474201455202717,
    '03001627/f4e5698718f3d4494311a07b696e63e3': 0.23414835541380372,
    '03001627/e6b2017501b20ce1eff1a662025674bf': 0.34979327241007196,
    '03001627/884341d10af51df9737a00f007529fbf': 0.36661618843465416,
    '03001627/e31d71ed32273fede42ac999db581f5e': 0.3038644502901682,
    '03001627/4a24652fbf2bed7e93583c67df8faf1': 0.3053681526027573,
    '03001627/8c629a89e570c8776a9cd58b3a6e8ee5': 0.33791394151487303,
    '03001627/387dc2c22bdf6d2a6df42853f67b5836': 0.30843791497069656,
    '03001627/bbcdf9d0ecf02e7e9fce07ae6c046b8c': 0.3046758783137524,
    '03001627/657790bc7fd16326c132086242d50af2': 0.30215088243823013,
    '03001627/7eabd19312bde1dc9335750905007562': 0.30359652809652504,
    '03001627/2af09bd8df40506c9e646678ef50aa3d': 0.28369787834571647,
    '03001627/b66a32bed74e203591f74997d435672d': 0.25416238360382204,
    '03001627/701551efa4f1f4fe3e478b26cb10ebe4': 0.27453734380407513,
    '03001627/43d13e139d0eb78668007dfca4077105': 0.27567694928973235,
    '03001627/6d6a92847f46d8e27b57eb4fc830f67b': 0.318986046718708,
    '03001627/645022ea9ce898648b442b160bcfb7fd': 0.25912855840530813,
    '03001627/5b1d0dad82acd6e5893104fdda835c64': 0.23678792372336271,
    '03001627/248e014f31771b31d3ddfaaa242f81a1': 0.3651945242931118,
    '03001627/1d828c69106609f8cd783766d090e665': 0.1939593525697592,
    '03001627/26c9e85dfa18af9fcf004563556ddb36': 0.28223431900241897,
    '03001627/f128d707527eb10cb04cb542e2c50eb4': 0.27235836056782664,
    '03001627/c9f5c127b44d0538cb340854b82a069f': 0.2174103981897043,
    '03001627/84767939783aade4611ea9b20dcb5c83': 0.3401630539464854,
    '03001627/c666bd15aaebd5b02de0bc4fc4d02dd6': 0.28120595854420705,
    '03001627/11d4f2a09184ec972b9f810ad7f5cbd2': 0.23375956249891147,
    '03001627/ea7be2b97e78d5b35a4480134e0cdd21': 0.3188617699173143,
    '03001627/408631c881e3b33cefb90719a33cc920': 0.22722047311141674,
    '03001627/2de1bd62aef66dc9bf65e1af50b5b7d4': 0.2745380517401244,
    '03001627/8a2a0cad888b871eaa84c578b771896d': 0.24530224003108347,
    '03001627/e3479f55f5894bb3c7f1f7c0570e288d': 0.26829807926252974,
    '03001627/3f7417590f1bcfded5c89ecb06d1099b': 0.27541307534205783,
    '03001627/cc2930e7ceb24691febad4f49b26ec52': 0.29027606028299086,
    '03001627/459bef9cabed55cc593ebeeedbff73b': 0.35610420394204634,
    '03001627/dfc85456795d943bbadc820495ddb59': 0.26337556029685144,
    '03001627/697cfbe6e043136b737a00f007529fbf': 0.2664178263673437,
    '03001627/7ad134826824de98d0bef5e87b92b95e': 0.2601930783769818,
    '03001627/aa2242ae4ea1074bad0881e4ef1ff29c': 0.30656229936543483,
    '03001627/fba62693a28b2e4c43f1c519d66bb167': 0.2357822472615468,
    '03001627/58ef4177c711f38fe302d4da760c718f': 0.28806227179224914,
    '03001627/ca2294ffc664a55afab1bffbdecd7709': 0.3316280255736537,
    '03001627/8abd5158ec94dfd8924bf081da6f024c': 0.2950230189760522,
    '03001627/d6075b23895c7d0880e85c92fa2351f7': 0.2151012911938732,
    '03001627/80fab0c55a60abb7dafb0be26f6b45d5': 0.27971451323632546,
    '03001627/d8774646afed0312732375ced502498': 0.41581939838154913,
    '03001627/5a5b11daa1b5344fb516c05d046e8e45': 0.3041330293650493,
    '03001627/6e50f19c52a760e3cc1159c3b443c932': 0.3252561166689675,
    '03001627/10c08a28cae054e53a762233fffc49ea': 0.25475012547626047,
    '03001627/117c0e0aafc0c3f81015cdff13e6d9f3': 0.21739340593931009,
    '03001627/3eef51c1ba49a32ef73a9267136cfb76': 0.17817059766632765,
    '03001627/665bfb42a0362f71d577f4b88a77dd38': 0.38938660739695746,
    '03001627/80bad2242183a77df69c1bc654d8fbbd': 0.20359793853296182,
    '03001627/3ef60b4e28c22b3bc7dd78af359f0fc6': 0.21303222935366029,
    '03001627/d4d9b991ff7d31e8c8687ff9b0b4e4ac': 0.217424365078993,
    '03001627/6fa2db75b28cc1375c728bbce49718a0': 0.25921945942587865,
    '03001627/17ab0917e215e4fcfd300048280f015a': 0.23867134749608981,
    '03001627/5d681a38c0de5545205884f75aba3a': 0.31490510594129895,
    '03001627/4a4c7abae3929595184740798d03a659': 0.2182130936737045,
    '03001627/e6ec608ccfb38d6247928239f46b6ef1': 0.3050868625191195,
    '03001627/5f2441ed2a9ec8fab5d55ded7962c792': 0.2559297705987723,
    '03001627/a11592a10d32207fd2c7b63cf34a2108': 0.2822276040448187,
    '03001627/ff2333f528efd790fc93ece3545739c4': 0.2731275648475552,
    '03001627/d020eee9e094050ad776c08b6a3d0a38': 0.2641135229501191,
    '03001627/fbca73a2c226a86a593a4d04856c4691': 0.32377871019330906,
    '03001627/99ae1b3f970c61fd5b56aadec5c0be6b': 0.31312686763915576,
    '03001627/6a28919186eb55ecf69d0cf4fdc89b12': 0.2435398494658779,
    '03001627/a10e8dc1cc9522b67a80d424f0f4074d': 0.2481898690823798,
    '03001627/b856a62e23ef65324b87db09ac4cfa73': 0.20867775472429062,
    '03001627/bf7e8e0dc4f4038cc2567be77cb7ab45': 0.2529760031622193,
    '03001627/48429b3467c7185060fcaed6cc231482': 0.2953046773573473,
    '03001627/f04698af574cb9847edf3a3d7d1bacae': 0.30901759154433295,
    '03001627/e6b0b43093f105277997a53584de8fa7': 0.27940372641019035,
    '03001627/5f2d4c625595dc2499b025797420aa58': 0.27403111911589173,
    '03001627/f1fc7d26395549ba5ad8ce80f1a173ac': 0.29077568193155956,
    '03001627/bf3f14225e8f899db62f9fb4b7f0626': 0.25514016844534354,
    '03001627/ed56af61297594bf1c4300651205adf3': 0.2633978736900763,
    '03001627/8ab6783b1dfbf3a8a5d9ad16964840ab': 0.2384376870991261,
    '03001627/f23ecf3348299cf743e99e0cae970928': 0.25320484958739403,
    '03001627/d764960666572084b1ea4e06e88051f3': 0.29691118760802526,
    '03001627/78261b526d28a436cc786970133d7717': 0.22535548069821643,
    '03001627/5ef3e4abd4386c8871bc6030acc85f1e': 0.27348474325347316,
    '03046257/58507d92c9c0a4f07b79156a61ad4c01': 0.24210892812233792,
    '03046257/f41e23b98991d0f535836c728d324152': 0.34256659449554905,
    '02942699/235a6dd25c0a6f7b66f19f26ac490096': 0.18864112080609208,
    '02871439/711126944f5bb83e1933ffef19678834': 0.24535517064666781,
    '02871439/c91abdb369f0e2a1933ffef19678834': 0.20444373083700307,
    '02871439/58b97051fb1efb3b4bd9e0690b0b191': 0.2693240097730432,
    '02871439/b8eb9918623a90fe14b86d5282eb8301': 0.2724581705609199,
    '02871439/ec882f5717b0f405b2bf4f773fe0e622': 0.22183038041095535,
    '02871439/f7b93826de3020f3a5f3ebd90cb33bd6': 0.20629757974095397,
    '02871439/3ba1563f381785bc6739a7caa0c577bd': 0.3319441024123248,
    '02871439/e6f306e6f391ace7b035d20a1a3ca345': 0.30570540465844603,
    '03991062/2dcd625ed44bbf1625ebd1cd0b422e32': 0.26290574140137735,
    '03991062/3fd59dd13de9ccfd703ecb6aac9c5d3c': 0.34491983565252426,
    '03991062/5e825f4aa6a916c544cd688b4bc0d629': 0.24881291955706472,
    '03991062/23c2a637319a07b425ebd1cd0b422e32': 0.3028944173888938,
    '03991062/5afc3b1bd57bf6482c2c0fe8f75ba056': 0.3121985865836113,
    '03991062/5cc4660eebade12d25ebd1cd0b422e32': 0.2688076515212309,
    '03991062/6dbdd4270e16cb9425ebd1cd0b422e32': 0.3196504941106921,
    '03991062/9d7710e65ad393114b3c42e318f3affc': 0.3278343896568729,
    '03991062/7c86cdecd3b2d29125ebd1cd0b422e32': 0.32430321389876954,
    '03991062/7c1303d3a19a1cef51f77a6d7299806': 0.2520942787595406,
    '03991062/6c9a25f120cdcacc25ebd1cd0b422e32': 0.3395011383119723,
    '03991062/eb8d2e7e18906c7f25ebd1cd0b422e32': 0.22079872149072213, #0.2
    '03991062/48862d7ed8b28f5425ebd1cd0b422e32': 0.25961522352098926,
    '03991062/870c7ddd93d5b7c524042e14aca574d2': 0.255164939873058,
    '03991062/3152bd6fb7bf09d625ebd1cd0b422e32': 0.3404096994165607,
    '03991062/4e5172f357714b7f78caa162a41a851e': 0.1690462268076837,
    '03991062/1c4257c50d27388525ebd1cd0b422e32': 0.2781578416882425,
    '03991062/f1c17606d5952d9225ebd1cd0b422e32': 0.26845688968899994,
    '03991062/d1ed787e654dd0ff25ebd1cd0b422e32': 0.31137676021742655,
    '03991062/433fedbf96f140fb25ebd1cd0b422e32': 0.3153347275354074,
    '03991062/8d87b950d8e192f5f51f77a6d7299806': 0.1530489868639284,
    '03991062/44aea02b6852ce98910e50f05b8001': 0.23012717284932138,
    '03991062/8c3c0ec3779a163098910e50f05b8001': 0.25625403952921166,
    '03991062/490e2e25da735cfd3df324363ca0723f': 0.2615222376903661,
    '03991062/b89de6e29a5a1d6425ebd1cd0b422e32': 0.29648423795558465,
    '03991062/8111c4fa78c69d7925ebd1cd0b422e32': 0.21184056364198547,
    '03991062/c0ed2720d248d4e125ebd1cd0b422e32': 0.2995133790991576,
    '03938244/4691e0947b1e2a6b685998681d42efb8': 0.3351977172094138,
    '03938244/71dd20123ef5505d5931970d29212910': 0.24779505452759512,
    '03938244/31db3f4dd9d5944c3628a80a75ee02dc': 0.23649248582473217,
    '03938244/b422f9f038fc1f4da3149acda85b1964': 0.33714581576381975,
    '03938244/3b5e274f653258a737f437b479038901': 0.28889512107477777,
    '03938244/f3833476297f19c664b3b9b23ddfcbc': 0.2439988495809625,
    '03938244/c665ecfac697faa1222129b9e83640a7': 0.3348988182355991,
    '04379243/57c21a71a3518b6a1af550e7b4aa14c': 0.2326588450676866,
    '04379243/6b9b672041acc540e61062b89cc2de3b': 0.2496724106673462,
    '04379243/81c8ec54ab47bb86b04cb542e2c50eb4': 0.27718908429031197,
    '04379243/8ccbd2949fd8809b82cdf8854f156846': 0.31485364797288695,
    '04379243/7e215b6386f3fd4156d1d06c447a736': 0.2602163173495344,
    '04379243/586edb4eba5c3c7557ab4b593540354': 0.27037760340016304,
    '04379243/67584a2261e175ccfbed972ae4fd63af': 0.2701806915855507,
    '04379243/37726dbb4357739bded526a7be77b30e': 0.25165761297169303,
    '04379243/ead93856b735ec90f0aeabfdcb4e1dd9': 0.24984458042497326,
    '04379243/d51c7bcf851a368f90193fd5f5187893': 0.28516799314617236,
    '04379243/9ff56887e5f00cff412a0eaf6d0f1809': 0.3698821821898761,
    '04379243/ab1d67b6f09b35424ea2d70ab68cd1d2': 0.13518324276871893,
    '04379243/87af702a9a5370aceea6a5a0ebf81e97': 0.3923480809940565,
    '04379243/d477a17223129fec53227dcd0d547ba6': 0.24348670670694347,
    '04379243/199d183157f213e0da7c128b58fc7554': 0.21732957493140945,
    '04379243/524af53b7863f506e227c1bcfe5b1fc6': 0.3166806699750222,
    '04379243/b5bc21c92dc997cb7209833c7512d6a2': 0.4417089777648633,
    '04379243/61a898c20ddb028dfebad4f49b26ec52': 0.3337971678222898,
    '04379243/d6b61af7935d36a6f0aeabfdcb4e1dd9': 0.2977388571512857,
    '04379243/970e70ae46244887c35d3c5d3b1fcf7': 0.2856490080009466,
    '04379243/8bb3a7e1cb24fe6febad4f49b26ec52': 0.1919261225285961,
    '04379243/ea45019340b754c155f46d55537192b6': 0.293290544285145,
    '04379243/1f748bcf0ee8eea7da9c49a653a829eb': 0.3016119040918398,
    '04379243/254bf8d40be1fcb025a517a55e2a2141': 0.33341580297995393,
    '04379243/95301825e69b3b2db04cb542e2c50eb4': 0.3050147317690796,
    '04379243/aa118e3ed06f00a85c886bf880a258e': 0.3155906296226216,
    '04379243/a0fd031270822841febad4f49b26ec52': 0.2595015020315732,
    '04379243/9feefc5eb43adb4fb7db0056a767efc7': 0.26675671786282573,
    '04379243/b9c756b2ff5d66ddfebad4f49b26ec52': 0.29386733825711986,
    '04379243/4d14547b54611e9bcf1ee9bc9708f08c': 0.29290679088342814,
    '04379243/758df6055459cdf6cf58a1b90d479c9': 0.20695377136760879,
    '04379243/649cea3b17ffb31bfebad4f49b26ec52': 0.2809006470442715,
    '04379243/8c67fd5a15e8d9defebad4f49b26ec52': 0.36061045406314834,
    '04379243/9a60b3b87a457c73f522eecffc49e6a3': 0.2188862660860571,
    '04379243/7fc3bc8542f4c17ce4511d9a59e40339': 0.2720439981367353,
    '04379243/1b82432d7a959b8dfebad4f49b26ec52': 0.2474085528720443,
    '04379243/4a9a73e93f19ece06652506d959dc71d': 0.3287455336192209,
    '04379243/2e3e46e427b45207765ee729adbdf968': 0.2746370781541623,
    '04379243/7d358a01c9467815a9505c473725122e': 0.2991201440375514,
    '04379243/b796639ea7368f3bec11953b27b8a03a': 0.3044683089068464,
    '04379243/843713faa2ee00cba5d9ad16964840ab': 0.2767530424005882,
    '04379243/4cd11ae56eba48684733824eae5cd9ae': 0.3051850919872057,
    '04379243/17624075a52c9b15cab01e89f60c9290': 0.33657782004595815,
    '04379243/882d74e3afe42d0b651fbe0e01830a4a': 0.26990644052240753,
    '04379243/b7a0dda52974fa642250bf58700b4d8f': 0.34973596424652276,
    '04379243/4a0db050c8703a8d6e3c8a33c4ddf2ef': 0.4204919670117183,
    '04379243/580373e581fa155d3ec45bd2bc895504': 0.32828506185554235,
    '04379243/a0864018495ae55cdef39da7703174e8': 0.32956389648922424,
    '04379243/d9994cf6d5d444379dbfd5cfd194350d': 0.28193506164777776,
    '04379243/7ee773e031400d09b4fc0a2b20c3cddd': 0.3069476693905946,
    '04379243/188ce43d9c8caabc5213169cc9897a9d': 0.26152773259820306,
    '04379243/aca4c523f999de86febad4f49b26ec52': 0.23992752198547573,
    '04379243/1408914f71c66166febad4f49b26ec52': 0.3265484013649964,
    '04379243/324f0d772a7b728c36350d50e191a45': 0.19920863940387673,
    '04379243/77b57f3eebab844707cdefe012d0353': 0.26701723803216243,
    '04379243/93f94ca2abb0e6aeda9c49a653a829eb': 0.3100057547321361,
    '04379243/3ce4b963a4869248febad4f49b26ec52': 0.3168479119720382,
    '04379243/74b8222078ba776c661673811de66400': 0.2955727474109995,
    '04379243/1ef6c2b9d413fb7c681404257d94ad9': 0.26978985777486764,
    '04379243/8aaca7e2c1b0ec549eea323f522c6486': 0.2854242861634302,
    '04379243/1aed00532eb4311049ba300375be3b4': 0.32786782760419925,
    '04379243/2425d3befad0440febad4f49b26ec52': 0.23990003257943382,
    '04379243/c6442db6d5fc94a62744bf8869518694': 0.24716063565259672,
    '04379243/b0abbb1a540e4b3431540522caac8407': 0.3212309247961766,
    '04379243/669a8114b9a602c2febad4f49b26ec52': 0.31333730710610846,
    '04379243/24d1d32aa33c38716a97150bb2a72733': 0.294917849057276,
    '04379243/7249c3e41c4807c0f7e0e05bae6131': 0.2583356349071718,
    '04379243/98fe480bea8f8f0486abe5555a3b447d': 0.238914969916438,
    '04379243/58160ac529c37aef1f0f01a76c5ff040': 0.29527257482634756,
    '04379243/cae4f0f8b87db72dbbdc99ec57ef9c40': 0.20142031774210906,
    '04379243/c733e81695923586754784b56fb4c23b': 0.30608729541372426,
    '04379243/d45385e0a60f71e1427fcd6e404d0cf5': 0.23662820476539395,
    '04379243/bc644d8f492e3c25febad4f49b26ec52': 0.31527377148767793,
    '04379243/4572e2658d6e6cfe531eb43ec132817f': 0.2826694475191026,
    '04379243/fe5e1df0653804d6ce4670b160b81e9': 0.2507756406842348,
    '04379243/3d4399c54a60ac26febad4f49b26ec52': 0.2893301179330152,
    '04379243/8d45802ef679d08a1a3b40747093a35e': 0.19964923548493466,
    '04379243/d40ba4b29c5ae69dae14646a8c8ddd34': 0.31617103538262104,
    '04379243/472796909612bf1f1353dc45068d6f44': 0.4166608208023914,
    '04379243/4116d19d60fc24f037a346dba83c013b': 0.27200633657904416,
    '04379243/db454c99849016f8febad4f49b26ec52': 0.2927663815172217,
    '04379243/b9c5de845a1f5ccf23f93d9b8d14f53c': 0.2793957476316928,
    '04379243/41d280b7db61ebddfebad4f49b26ec52': 0.36292739570345595,
    '04379243/6f03a6f024145fc9febad4f49b26ec52': 0.29524535899871696,
    '04379243/3dd217a06e76292b372b6139ac78b39e': 0.2753278554897106,
    '04379243/cb71e1cf52531981593ebeeedbff73b': 0.32003333412440893,
    '04379243/9f76504d9b551e548c37cfe791015e2f': 0.37208169535456526,
    '04379243/45c5ee611c73b90a509330ce00eb0b20': 0.3143074959461117,
    '04379243/a2561614d015f2fdfebad4f49b26ec52': 0.27860111156104383,
    '04379243/fe0ac2e334ad4d844fb315ce917a9ec2': 0.29047481002574754,
    '04379243/9c9554e0883818c9febad4f49b26ec52': 0.283230710701327,
    '04379243/c85ba9a3e1896eb254adaad15f0d584e': 0.2731296128697195,
    '04379243/797ecd23342e744bbff15b656f256f05': 0.25518793181235333,
    '04379243/915855afcc5f8918ab27cc93fdc68c94': 0.2926077219467744,
    '04379243/75ddfe6d71b14184134155606601dcb2': 0.2755089304802004,
    '04379243/7dc6c6f96b77b7d3febad4f49b26ec52': 0.36865491387379157,
    '04379243/f38a18709e55e4647ee217c21e683487': 0.27079920711465555,
    '04379243/3931ce39e77a25a9dfefa992cb59ea0': 0.28075712730308033,
    '04379243/575b467b6ebb2f234eaa3180e8182d9e': 0.30778843491305785,
    '04379243/f6f3b8e08af617e44733824eae5cd9ae': 0.2429340462478592,
    '04379243/cd224ca2a8aa04b11362d127df6d94eb': 0.3310462718560743,
    '04379243/dace4e7f0ec285abcaa22a10624245b6': 0.27985688874477954,
    '04379243/da8ec638b64227066d767b6d0313d349': 0.29539314886207646,
    '04379243/952da8ad85350267b9b072e1f62798f5': 0.2941584181754032,
    '04379243/51cfb783895a8af9febad4f49b26ec52': 0.32665656735452714,
    '04379243/ff2b5b315173f3244fb315ce917a9ec2': 0.3016606149934463,
    '04379243/4c4675bc602b2a95febad4f49b26ec52': 0.2634548622886725,
    '04379243/425544b66203da392ebeb1e6a8111f53': 0.4946576827599186,
    '04379243/fe82d64b0268ba75febad4f49b26ec52': 0.2987631193368364,
    '04379243/87ebd707ca90700d8b424343280aeccb': 0.2036957111597284,
    '04379243/4f7f8af38b1a13f67c1b348241918030': 0.2972472116502579,
    '04379243/1cd6a00b71f02b06430c2c15987e4cd': 0.26448328287181005,
    '03211117/1d1cd29446bff16090adfc5ef6476a6e': 0.4758888022737482,
    '03691459/52e827d2f969a2b61f2b6130e0fe93a6': 0.2513604491570652,
    '03691459/f0f9a2082454542751dfe6844b6e8393': 0.28919258291611305,
    '03691459/bbda555f0874e9d5b35234ceed4dc815': 0.41396553720047535,
    '04256520/b44d152534373752febad4f49b26ec52': 0.34255735611908317,
    '04256520/d3425554004d834f6dbc9d74bad392c': 0.1819656454192386,
    '04256520/ae9d32ee01af191a32dc1e76c3474bc': 0.30077427871314677,
    '04256520/388aebe52bbe88757143b902ce4e435d': 0.2695690914357143,
    '04256520/575876c91251e1923d6e282938a47f9e': 0.2465198488048127,
    '04256520/bd3cb48163e43810f29b3e56ea45251a': 0.2398063826531157,
    '04256520/df7cced6f0e5e65c26e55d59015dabc6': 0.31393154755875186,
    '04256520/cd249bd432c4bc75b82cf928f6ed5338': 0.24875773372794194,
    '04256520/248e014f31771b31d3ddfaaa242f81a1': 0.3651945242931118,
    '04256520/3f8523f11a622d8d6983f351200ac6a': 0.28358734579175243,
    '04256520/d6d69d04e3c34465e9fa215d22832290': 0.3012059086959642,
    '04256520/3f8aba017afa6d94f78aa2d67f081607': 0.25134347285239617,
    '04256520/68fce005fd18b5af598a453fd9fbd988': 0.35,
    '03207941/69b0a23eb87e1c396694e76612a795a6': 0.24804073889257744,
    '03325088/1f223cac61e3679ef235ab3c41aeb5b6': 0.47440583274796444,
    '03325088/7ade4c8d7724e56b76d20e73c57c9a03': 0.5,
    '02801938/bcc429595319716b726dbbf7bc5e4df3': 0.2443209756271703,
    '02801938/5208bc4450a16d0e4b3c42e318f3affc': 0.2528763876051636,
    '02801938/be3c2533130dd3da55f46d55537192b6': 0.388349532841341,
    '02801938/97c3dff51452522814513156cf2b8d0d': 0.17695602924172202,
    '02801938/9e4a936285f32194e1a03d0bf111d109': 0.22784618116173397,
    '02801938/d224635923b9ec4637dc91749a7c4915': 0.28039080824377316,
    '02801938/acfe521c412fcd04564c0afd61663476': 0.2505751267753218,
    '03624134/b80c5d63962c04b41395331ebe4786cd': 0.386817271713328,
    '03624134/66955a3156556f0d1395331ebe4786cd': 0.3517663207978639,
    '03624134/3a4f0118a57093cbf7c4ed45ce654123': 0.27549847612973255,
    '03624134/2e9a0e216c08293d1395331ebe4786cd': 0.3579041034522509,
    '03624134/c141abaec55e87e691687e259c21528d': 0.4682564356182648,
    '03624134/1897adf19953756d91687e259c21528d': 0.4654626701659226,
    '03624134/a73a2d9584b2cbc81395331ebe4786cd': 0.34481705702888404,
    '03624134/2f74196bd5cb462727c767f081f1365a': 0.3530325758763523,
    '04090263/d16ba2810dd8489cfcace4d823343363': 0.36580559352527237,
    '04090263/1fa5a9170bb276e7fcace4d823343363': 0.38827163553233524,
    '04090263/9642b6d77734a1c351cfdb4c9f126c12': 0.33421556265558916,
    '02933112/8e1a1e2879cfa2d6fe395915d44df772': 0.29216781907355655,
    '02933112/6343efcc64b331b3e3f7a74e12a274ef': 0.34009363924766967,
    '02933112/58b97051fb1efb3b4bd9e0690b0b191': 0.21932400977304323,
    '02933112/1f4ccbdbd0162e9be3f7a74e12a274ef': 0.23687889216033253,
    '02933112/33ebdfbed1aff9fb12d532e9deb7e02b': 0.2234013755553408,
    '02933112/85502157d9e253d411fc2b865c2a185b': 0.37097950991290135,
    '02933112/cd251287fd34d7e0e3f7a74e12a274ef': 0.3569388794982453,
    '02933112/bfdb60bd61d083536739a7caa0c577bd': 0.3684828163688074,
    '02691156/886942791e830bf1d32b1717fde97410': 0.4260345405467737,
    '02773838/f5800755a78fc83957be02cb1dc1e62': 0.37005492349238794,
    '02828884/7e8caf5bf2eb1a61ecaa3c66b0328b42': 0.39552529436277406,
    '02828884/444e7c5709eca2496f61afd58e50ae2': 0.30553663124975367,
    '02828884/7769891a8af54054bfde7937440ef438': 0.26328581076194074,
    '02828884/7e73d9c7082453987b019ecf3e106a55': 0.272857621789694,
    '02828884/39d8fdb56b0e160dbcceec49967c0de7': 0.30249821911866226,
    '02828884/137fdd05ae4e69c7a68359455a0ffe24': 0.3636460238628736,
    '02828884/d6075b23895c7d0880e85c92fa2351f7': 0.2651012911938732,
    '02828884/302c64b3f9d0e0a3961c690e3d679ac7': 0.37262511223866135,
    '02828884/19bb2f65f3de8f5fbdc7943e19c9bdf7': 0.29692137931425705,
    '02828884/10cfa696ba2259ccbbba142d6df53ce': 0.29593628678247086,
    '02828884/dbd0698df1623b0391da37ff8bdd2524': 0.25482850396661644,
    '03797390/c51b79493419eccdc1584fff35347dc6': 0.39853867076304234,
    '03797390/1d18255a04d22794e521eeb8bb14c5b3': 0.2082370476854743,
    '02876657/6b810dbc89542fd8a531220b48579115': 0.2410093794578824,
    '02876657/d9aee510fd5e8afb93fb5c975e8de2b7': 0.23366564984081412,
    '02876657/1df41477bce9915e362078f6fc3b29f5': 0.3265737295181812,
    '02876657/56c23ba1699f6294435b5a0263ddd2e2': 0.23235115245198346,
    '02876657/7746997b8cfd8d11f4718731863dd64d': 0.35992130001177347,
    '02876657/78d707f4d87b5bfd730ff85f0d8004ee': 0.42442472527435726,
    '02876657/9fe7e6a7bf8ca964efad53eb3f0b36fa': 0.3181704164311424,
    '02876657/dc0926ce09d6ce78eb8e919b102c6c08': 0.3959517942378955,
    '02876657/1b64b36bf7ddae3d7ad11050da24bb12': 0.3339083914873065,
    '02876657/5ad47181a9026fc728cc22dce7529b69': 0.2819320476806692,
    '02876657/621e786d6343d3aa2c96718b14a4add9': 0.3096872077369119,
    '02876657/c3767df815e0e43e4c3a35cee92bb95b': 0.23282710160597733,
    '02876657/ab6792cddc7c4c83afbf338b16b43f53': 0.2824057726614718,
    '02876657/3ba7dd61736e7a96270c0e719fe4ed97': 0.33701174377576115,
    '02876657/e8b48d395d3d8744e53e6e0633163da8': 0.3077651947589247,
    '03337140/7d4abd821dfbc7dfcc786970133d7717': 0.23166213599879573,
    '02747177/cf158e768a6c9c8a17cab8b41d766398': 0.2733196973552894,
    '02747177/9fe4d78e7d4085c2f1b010366bb60ce8': 0.23,
    '02747177/9ee464a3fb9d3e8e57cd6640bbeb736d': 0.23439602186310232,
    '02747177/8026b11c2f66d77ed5a4ff0c97164231': 0.2098441653314233,
    '02747177/acfe521c412fcd04564c0afd61663476': 0.2505751267753218,
    '02843684/7dd57384aa290a835821cea205f2a4bb': 0.3,
    '04530566/907c179103304ce8efcba30d0f49b70': 0.34159289712768015,
    '04530566/9472a24df8372cd42e436d38f27146ec': 0.4465681610786845,
    # Below: mostly colorless objects. Added June 19 2020.
    '03797390/3143a4accdc23349cac584186c95ce9b': 0.25,
    '03797390/c39fb75015184c2a0c7f097b1a1f7a5': 0.25,
    '02880940/e4c871d1d5e3c49844b2fa2cac0778f5': 0.25,
    '02880940/45603bffc6a2866b5d1ac0d5489f7d84': 0.25,
    '02691156/d605a53c0917acada80799ffaf21ea7d': 0.5,
    '03991062/9da456e7bae24501ffc6e457221b9271': 0.25,
    '03991062/5563324c9902f243a2c59a4d90e63212': 0.25,
    '02808440/302618414a9991de3321831d2245cf06': 0.25,
    '02808440/fd34f47eb1b816139a625c8b524db46e': 0.25,
    '02808440/1dc36bb29702c28b3321831d2245cf06': 0.25,
    '02808440/ea7913efbe22abed412deb0d2b0f3dcd': 0.25,
    '02808440/cca20dbad3faf4343321831d2245cf06': 0.25, #0.3
    '02818832/4954953090ca7442527e7f2c027f7469': 0.35,
    '03593526/de673ddf9df03b8278cf1a714198918': 0.25,
    '03593526/1ca73dffe31553efcb349a60fd15aa15': 0.25,
    '03593526/bcf5a4b764ddeac759f9892433e1b1f4': 0.25,
    '03593526/a791d4fa1d840408c5beea20858a99d5': 0.25,
    '03593526/9097ce398b9700a27e561f865dc44fc5': 0.25,
    '03593526/6a13375f8fce3142e6597d391ab6fcc1': 0.25,
    '03593526/c1be3d580b4088bf4cc80585c0d3d970': 0.25, #0.35
    '03593526/2ff5347d6ee079855337cdc4b758988c': 0.25,
    '03593526/cf65c7fb56850194490ad276cd2af3a4': 0.25,
    '03593526/aa638e39c28f3a184800dfbcda5cce3': 0.25,
    '03593526/ffc7e98720e71017b3878cedd8c8fe6c': 0.25, #0.2
    '03593526/af61c129521b9a36ad56360b1d2e97b8': 0.25,
    '03593526/ce2508ec4476b2cbf51f77a6d7299806': 0.25,
    '04256520/e74d866f44f857e77b5d58e18a4bdcae': 0.25,
    '04256520/5171a910435f4c949a502993c14408e4': 0.25,
    '04256520/c8108de19d8a3005c5beea20858a99d5': 0.25,
    '04256520/ae4f28a7c4e22d9535dda488a4bbb1e1': 0.25,
    '03261776/51245ad5a0571188992fd3dac901d508': 0.4,
    '03325088/13cdb5df9a944fcbb7a867e9b35a1295': 0.25,
    '03325088/af708fe6eac1bc9450da8b99982a3057': 0.25,
    '03325088/4477714b35747609f34d244dc02df229': 0.25,
    '02876657/8ea8ced5529a3ffa7ae0a62f7ca532f1': 0.25,
    '02876657/cdeccf2f410846d0e0155f56493d36bc': 0.25,
    '03636649/23eaba9bdd51a5b0dfe9cab879fd37e8': 0.25,
    '03636649/ed323758d0f61cfe6085a0a38e2f255': 0.25,
    '03636649/a82af4e7e81334f8876b399a99a15c0f': 0.25,
    '03636649/11913615a1b732d435836c728d324152': 0.25,
    '02801938/98c3ddee85264efd7cd51b1084c649a6': 0.25,
    '04379243/ec316148b4cdd446b6068c62e84866a1': 0.25,
    '02828884/3e0694b77418eb25d2b12aa6a0f050b3': 0.4,
    '02828884/6f0723826537010c870f22c94729669b': 0.25,
    '02828884/5b50871735c5cce2d2b12aa6a0f050b3': 0.35,
    '02828884/8d074f177479ac42628516f95b4691f': 0.25,
    '04530566/80c6a14accb189a9c2c2c81e2232aa95': 0.4,
    '04530566/31a41e6a73c5d019efffdb45d12d0585': 0.4,
    '04530566/de010f7468ceefc6fcfb3ae2df2f7efd': 0.4,
    '04530566/6c1cfb2fe245b969c2e818a707fdb3e0': 0.25, #0.4
    '02871439/43731a6a4bd64ae5492d9da2668ec34c': 0.25,
    '02871439/cc38bc7db90f43d214b86d5282eb8301': 0.4,
    '02954340/e823673c1edd73fb97c426435543a860': 0.25,
    '03001627/ddfe96c6ec86b8752cbb5ed9636a4451': 0.25,
    '02747177/8fff3a4ba8db098bd2b12aa6a0f050b3': 0.25,
    '02747177/e7682974949a6aadea9a778eef212687': 0.25,
    '02747177/4dbbece412ef64b6d2b12aa6a0f050b3': 0.25,
}

SHAPENET_ASSET_PATH = "/home/ashvin/ros_ws/src/ashvindev/bullet-objects/ShapeNetCore/"
#SHAPENET_ASSET_PATH = "/Users/sasha/Desktop/gauss/ashvindev/bullet-objects/ShapeNetCore/"
test_set = ['mug', 'square_deep_bowl', 'bathtub', 'crooked_lid_trash_can', 'beer_bottle', 
    'l_automatic_faucet', 'toilet_bowl', 'narrow_top_vase']

def import_shapenet_metadata():
    metadata_spec = importlib.util.spec_from_file_location(
        "metadata", osp.join(SHAPENET_ASSET_PATH, "metadata.py"))
    shapenet_metadata = importlib.util.module_from_spec(metadata_spec)
    metadata_spec.loader.exec_module(shapenet_metadata)
    return shapenet_metadata.obj_path_map, shapenet_metadata.path_scaling_map

def load_shapenet_object(object_path, scaling, object_position, scale_local=0.5):
    path = object_path.split('/')
    dir_name, object_name, = path[-2], path[-1]

    # Randomize initial theta
    quat = deg_to_quat(np.random.randint(0, 360, size=3))
    
    # With p=0.5, randomize color
    if np.random.uniform() < 0.5:
        rgba = list(np.random.choice(range(256), size=3) / 255.0) + [1]
    else:
        rgba = None
   
    obj = load_obj(
        SHAPENET_ASSET_PATH + '/ShapeNetCore_vhacd/{0}/{1}/model.obj'.format(dir_name, object_name),
        SHAPENET_ASSET_PATH + '/ShapeNetCore.v2/{0}/{1}/models/model_normalized.obj'.format(dir_name, object_name),
        object_position, quat, rgba=rgba, scale=scale_local*scaling['{0}/{1}'.format(dir_name, object_name)])

    return obj

class SawyerRigMultiobjV0(SawyerBaseEnv):

    def __init__(self,
                 goal_pos=(0.75, 0.2, -0.1),
                 reward_type='shaped',
                 reward_min=-2.5,
                 randomize=True,
                 observation_mode='state',
                 obs_img_dim=84,
                 success_threshold=0.05,
                 transpose_image=False,
                 invisible_robot=False,
                 object_subset=None,
                 DoF=4,
                 *args,
                 **kwargs
                 ):
        """
        Grasping env with a single object
        :param goal_pos: xyz coordinate of desired goal
        :param reward_type: one of 'shaped', 'sparse'
        :param reward_min: minimum possible reward per timestep
        :param randomize: whether to randomize the object position or not
        :param observation_mode: state, pixels, pixels_debug
        :param obs_img_dim: image dimensions for the observations
        :param transpose_image: first dimension is channel when true
        :param invisible_robot: the robot arm is invisible when set to True
        """
        assert DoF in [3, 4, 6]
        self.goal_pos = np.asarray(goal_pos)
        self._reward_type = reward_type
        self._reward_min = reward_min
        self._randomize = randomize
        self._observation_mode = observation_mode
        self._transpose_image = transpose_image
        self._invisible_robot = invisible_robot
        self.image_shape = (obs_img_dim, obs_img_dim)
        self.image_length = np.prod(self.image_shape) * 3  # image has 3 channels
        self.object_subset = object_subset
        self.DoF = DoF

        #self.object_dict, self.scaling = self.get_object_info()

        self._object_position_low = (.65, -0.05, -.3)
        self._object_position_high = (.75, 0.05, -.3)
        self._fixed_object_position = (.75, 0.2, -.36)
        self._success_threshold = success_threshold
        self.obs_img_dim = obs_img_dim #+.15
        self._view_matrix_obs = bullet.get_view_matrix(
            target_pos=[.7, 0, -0.3], distance=0.3,
            yaw=90, pitch=-15, roll=0, up_axis_index=2)
        self._projection_matrix_obs = bullet.get_projection_matrix(
            self.obs_img_dim, self.obs_img_dim)
        self.dt = 0.1
        super().__init__(*args, **kwargs)

    def get_object_info(self):
        complete_object_dict, scaling = import_shapenet_metadata()
        complete = self.object_subset is None
        train = self.object_subset == 'train'
        test = self.object_subset == 'test'

        object_dict = {}
        for k in complete_object_dict.keys():
            in_test = (k in test_set)
            if complete:
                object_dict[k] = complete_object_dict[k]
            if train and not in_test:
                object_dict[k] = complete_object_dict[k]
            if test and in_test:
                object_dict[k] = complete_object_dict[k]
        return object_dict, scaling


    def _set_spaces(self):
        act_dim = self.DoF + 1
        act_bound = 1
        act_high = np.ones(act_dim) * act_bound
        self.action_space = gym.spaces.Box(-act_high, act_high)

        observation_dim = 11
        obs_bound = 100
        obs_high = np.ones(observation_dim) * obs_bound
        state_space = gym.spaces.Box(-obs_high, obs_high)

        self.observation_space = Dict([
            ('observation', state_space),
            ('state_observation', state_space),
            ('desired_goal', state_space),
            ('state_desired_goal', state_space),
            ('achieved_goal', state_space),
            ('state_achieved_goal', state_space),
        ])



    def _load_meshes(self):
        if self._invisible_robot:
            self._sawyer = bullet.objects.sawyer_invisible()
        else:
            self._sawyer = bullet.objects.sawyer_finger_visual_only()
        self._table = bullet.objects.table()
        self._objects = {}
        self._sensors = {}
        self._workspace = bullet.Sensor(self._sawyer,
            xyz_min=self._pos_low, xyz_max=self._pos_high,
            visualize=False, rgba=[0,1,0,.1])
        self._end_effector = bullet.get_index_by_attribute(
            self._sawyer, 'link_name', 'gripper_site')
        if self._randomize:
            object_position = np.random.uniform(
                low=self._object_position_low, high=self._object_position_high)
        else:
            object_position = self._fixed_object_position
        #object_name, object_id = random.choice(list(self.object_dict.items()))
        #print("Current Object: " + object_name)

        self._objects = {
            'obj': bullet.objects.lego(pos=object_position)
            # 'obj': load_shapenet_object(
            #     object_id,
            #     self.scaling,
            #     object_position)
        }

        # Allow the objects to land softly in low g
        p.setGravity(0, 0, -1)
        for _ in range(100):
            bullet.step()
        # After landing, bring to stop
        p.setGravity(0, 0, -10)
        for _ in range(100):
            bullet.step()

    def _format_action(self, *action):
        if self.DoF == 3:
            if len(action) == 1:
                delta_pos, gripper = action[0][:-1], action[0][-1]
            elif len(action) == 2:
                delta_pos, gripper = action[0], action[1]
            else:
                raise RuntimeError('Unrecognized action: {}'.format(action))
            return np.array(delta_pos), gripper
        elif self.DoF == 4:
            if len(action) == 1:
                delta_pos, delta_yaw, gripper = action[0][:3], action[0][3:4], action[0][-1]
            elif len(action) == 3:
                delta_pos, delta_yaw, gripper = action[0], action[1], action[2]
            else:
                raise RuntimeError('Unrecognized action: {}'.format(action))
            delta_angle = [0, 0, delta_yaw]
            return np.array(delta_pos), np.array(delta_angle), gripper
        else:
            if len(action) == 1:
                delta_pos, delta_angle, gripper = action[0][:3], action[0][3:6], action[0][-1]
            elif len(action) == 3:
                delta_pos, delta_angle, gripper = action[0], action[1], action[2]
            else:
                raise RuntimeError('Unrecognized action: {}'.format(action))
            return np.array(delta_pos), np.array(delta_angle), gripper


    def step(self, *action):
        pos = bullet.get_link_state(self._sawyer, self._end_effector, 'pos')
       
        if self.DoF == 3:
            delta_pos, gripper = self._format_action(*action)
        else:
            delta_pos, delta_angle, gripper = self._format_action(*action)
            angle = bullet.quat_to_deg(self.theta) + delta_angle
            self.theta = bullet.deg_to_quat(angle)

        pos += delta_pos * self._action_scale
        pos = np.clip(pos, self._pos_low, self._pos_high)

        self._simulate(pos, self.theta, gripper)
        if self._visualize: self.visualize_targets(pos)

        observation = self.get_observation()
        info = self.get_info()
        reward = self.get_reward(info)
        done = False
        self._prev_pos = bullet.get_link_state(self._sawyer, self._end_effector, 'pos')
        return observation, reward, done, info

    def get_info(self):
        object_pos = np.asarray(self.get_object_midpoint('obj'))
        height = object_pos[2]
        object_goal_distance = np.linalg.norm(object_pos - self.goal_pos)
        end_effector_pos = self.get_end_effector_pos()
        object_gripper_distance = np.linalg.norm(
            object_pos - end_effector_pos)
        gripper_goal_distance = np.linalg.norm(
            self.goal_pos - end_effector_pos)
        object_goal_success = int(object_goal_distance < self._success_threshold)
        picked_up = height > -0.36

        info = {
            # 'object_gripper_distance': object_gripper_distance,
            # 'gripper_goal_distance': gripper_goal_distance,
            'object_goal_distance': object_goal_distance,
            'object_goal_success': object_goal_success,
            'object_height': height,
            'picked_up': picked_up,
        }

        return info

    def get_diagnostics(self, paths):
        diagnostics = OrderedDict()
        state_key = "state_observation"
        goal_key = "state_desired_goal"
        values = []
        for i in range(len(paths)):
            state = paths[i]["observations"][-1][state_key][4:7][2]
            goal = paths[i]["observations"][-1][goal_key][4:7]
            distance = np.linalg.norm(state - goal)
            values.append(distance)
        diagnostics_key = goal_key + "/final/height"
        diagnostics.update(create_stats_ordered_dict(
            diagnostics_key,
            values,
        ))

        values = []
        for i in range(len(paths)):
            for j in range(len(paths[i]["observations"])):
                state = paths[i]["observations"][j][state_key][4:7][2]
                goal = paths[i]["observations"][j][goal_key][4:7]
                distance = np.linalg.norm(state - goal)
                values.append(distance)
        diagnostics_key = goal_key + "/height"
        diagnostics.update(create_stats_ordered_dict(
            diagnostics_key,
            values,
        ))
        return diagnostics

    def get_contextual_diagnostics(self, paths, contexts):
        diagnostics = OrderedDict()
        state_key = "state_observation"
        goal_key = "state_desired_goal"
        values = []
        for i in range(len(paths)):
            state = paths[i]["observations"][-1][state_key][4:7]
            height = state[2]
            goal = contexts[i][goal_key][4:7]
            distance = np.linalg.norm(state - goal)
            values.append(height)
            #values.append(distance)
        #diagnostics_key = goal_key + "/final/distance"
        diagnostics_key = goal_key + "/final/height"
        diagnostics.update(create_stats_ordered_dict(
            diagnostics_key,
            values,
        ))

        values = []
        for i in range(len(paths)):
            for j in range(len(paths[i]["observations"])):
                state = paths[i]["observations"][j][state_key][4:7]
                height = state[2]
                goal = contexts[i][goal_key][4:7]
                distance = np.linalg.norm(state - goal)
                values.append(height)
                #values.append(distance)
        #diagnostics_key = goal_key + "/distance"
        diagnostics_key = goal_key + "/height"
        diagnostics.update(create_stats_ordered_dict(
            diagnostics_key,
            values,
        ))
        return diagnostics

    def render_obs(self):
        img, depth, segmentation = bullet.render(
            self.obs_img_dim, self.obs_img_dim, self._view_matrix_obs,
            self._projection_matrix_obs, shadow=0, gaussian_width=0)
        if self._transpose_image:
            img = np.transpose(img, (2, 0, 1))
        return img

    def set_goal(self, goal):
        self.goal_pos = goal['state_desired_goal'][4:7]

    def get_image(self, width, height):
        image = np.float32(self.render_obs())
        return image

    def get_reward(self, info):
        return info['object_goal_success'] - 1

    def reset(self):
        bullet.reset()
        bullet.setup_headless(self._timestep, solver_iterations=self._solver_iterations)
        self._load_meshes()
        self._format_state_query()

        self._prev_pos = np.array(self._pos_init)
        self.theta = bullet.deg_to_quat([180, 0, 0])

        low, high = self._pos_low[:], self._pos_high[:]
        if np.random.uniform() < 0.5:
            low[2], high[2] = -0.36, -0.36

        self.goal_pos = np.random.uniform(low=low, high=high)

        #if self._visualize: self.visualize_targets(pos)

        bullet.position_control(self._sawyer, self._end_effector, self._prev_pos, self.theta)
        # self._reset_hook(self)
        for _ in range(3):
            action = np.array([0 for i in range(self.DoF)] + [-1])
            self.step(action)
        return self.get_observation()

    def format_obs(self, obs):
        if len(obs.shape) == 1:
            return obs.reshape(1, -1)
        return obs

    def compute_reward(self, obs, actions, next_obs, contexts):
        height = self.format_obs(next_obs['state_observation'])[:, 4:7][:,2]
        reward = (height + 0.345) / 0.16 - 1
        return reward
    
    # def compute_reward(self, obs, actions, next_obs, contexts):
    #     obj_state = self.format_obs(next_obs['state_observation'])[:, 4:7]
    #     obj_goal = self.format_obs(contexts['state_desired_goal'])[:, 4:7]
    #     object_goal_distance = np.linalg.norm(obj_state - obj_goal, axis=1)
    #     object_goal_success = object_goal_distance < self._success_threshold
    #     return object_goal_success - 1


    def get_observation(self):
        left_tip_pos = bullet.get_link_state(
            self._sawyer, 'right_gripper_l_finger_joint', keys='pos')
        right_tip_pos = bullet.get_link_state(
            self._sawyer, 'right_gripper_r_finger_joint', keys='pos')
        left_tip_pos = np.asarray(left_tip_pos)
        right_tip_pos = np.asarray(right_tip_pos)

        gripper_tips_distance = [np.linalg.norm(
            left_tip_pos - right_tip_pos)]
        end_effector_pos = self.get_end_effector_pos()

        object_info = bullet.get_body_info(self._objects['obj'],
                                           quat_to_deg=False)
        object_pos = object_info['pos']
        object_theta = object_info['theta']
        
        observation = np.concatenate(
            (end_effector_pos, gripper_tips_distance,
             object_pos, object_theta))

        goal_pos = np.concatenate(
            (self.goal_pos, gripper_tips_distance,
             self.goal_pos, object_theta))

        obs_dict = dict(
            observation=observation,
            state_observation=observation,
            desired_goal=goal_pos,
            state_desired_goal=goal_pos,
            achieved_goal=observation,
            state_achieved_goal=observation,
            )

        return obs_dict